<html>

<head>
  <!--jQuery & jQueryUI -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

  <!--Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <!-- FontAwesome icons -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

</head>

<body>

  <div class="container">
    <div class="row">
      <div class="col-md-8">

        <p id="sessionLink">https://web-b-ebscohost-com.ezproxy.ccac.edu/ehost/detail/detail?vid=2&sid=bd584d59-0a3b-4be8-b11e-af496056d3eb%40pdc-v-sessmgr06&bdata=JnNpdGU9ZWhvc3QtbGl2ZSZzY29wZT1zaXRl#AN=146193966&db=ccm</p>
        <p id="permalink">https://ezproxy.ccac.edu/login?url=https://search.ebscohost.com/login.aspx?direct=true&site=eds-live&db=ccm&AN=146193966</p>

        <h2></h2>
        <div class="form-group">
          <label for="sessionUrl">URL for OneSearch/Ebscohost Article</label>
          <input type="text" class="form-control" id="sessionUrl" placeholder="Paste URL here">
        </div>


        <p>
          <button id="btnConvert" class="btn btn-primary btn-lg" type="button">Convert URL</button> <button id="btnReset" class="btn btn-primary btn-lg" type="button">Reset</button>
        </p>
        <p>

          <div class="row">
            <div class="well" id="well">
              <div id="result"></div>
            </div>
        </p>


        OneSearch search URL: https://eds.a.ebscohost.com/eds/results?vid=0&sid=49f347b3-40cb-42e7-b273-9f30c24c007e%40sdc-v-sessmgr02&bquery=testing&bdata=JmNsaTA9RlQxJmNsdjA9WSZ0eXBlPTAmc2VhcmNoTW9kZT1TdGFuZGFyZCZzaXRlPWVkcy1saXZl <br>
        Ebscohost search URL:
        https://web.b.ebscohost.com/ehost/results?vid=0&sid=443b7fb1-73a8-4e2f-8f0c-5aa8f7f27df6%40sessionmgr101&bquery=global&bdata=JmRiPWY1aCZjbGkwPUZUJmNsdjA9WSZ0eXBlPTEmc2VhcmNoTW9kZT1TdGFuZGFyZCZzaXRlPWVob3N0LWxpdmUmc2NvcGU9c2l0ZQ%3d%3d
      </div>

    </div>
  </div>

  <script>
    $(document).ready(function() {
      // OneSearch OneSearch
      // https://eds.a.ebscohost.com/eds/results?vid=0&sid=49f347b3-40cb-42e7-b273-9f30c24c007e%40sdc-v-sessmgr02&bquery=testing&bdata=JmNsaTA9RlQxJmNsdjA9WSZ0eXBlPTAmc2VhcmNoTW9kZT1TdGFuZGFyZCZzaXRlPWVkcy1saXZl
      // re for EDS search &bquery=.*&

      // Valid EDS search
      // https://ezproxy.ccac.edu/login?url=https://search.ebscohost.com/login.aspx?direct=true&scope=site&type=0&site=eds-live&custid=eds&groupid=ccallegy&profid=main&lang=en&bquery=%s

      // Valid Ebscohost OneSearch
      // https://ezproxy.ccac.edu/login?url=http://search.epnet.com/login.aspx?direct=true&AuthType=cookie,ip,url,uid&bQuery=%s&db=f5h
      setupForm();

      function setupForm() {
        $('#well').hide();
        $('#success').hide();
        $('#sessionUrl').val("");
        $('#sessionUrl').focus();
      }

      function resolveUrl(url) {
        var str = "";
        str = url;
        console.log("resolveUrl", url);
        console.log("slice", url.slice(0, 33))



        /*
          OneSearch search URL: https://eds.a.ebscohost.com/eds/results?vid=0&sid=49f347b3-40cb-42e7-b273-9f30c24c007e%40sdc-v-sessmgr02&bquery=testing&bdata=JmNsaTA9RlQxJmNsdjA9WSZ0eXBlPTAmc2VhcmNoTW9kZT1TdGFuZGFyZCZzaXRlPWVkcy1saXZl <br>
          Ebscohost search URL: https://web.b.ebscohost.com/ehost/results?vid=0&sid=443b7fb1-73a8-4e2f-8f0c-5aa8f7f27df6%40sessionmgr101&bquery=global&bdata=JmRiPWY1aCZjbGkwPUZUJmNsdjA9WSZ0eXBlPTEmc2VhcmNoTW9kZT1TdGFuZGFyZCZzaXRlPWVob3N0LWxpdmUmc2NvcGU9c2l0ZQ%3d%3d
        */
      }

      $('#btnConvert').click(function() {
        var sessionUrl = $('#sessionUrl').val();
        resolveUrl(sessionUrl);
        var errorMsg = "<b>Sorry, I could not find the 'AN' or 'db' codes in that URL. Please check your URL and try again!</b>";
        var successMsg = "<div id='success'><b>Success! Here's a permalink that should get you to the document: <br><br></b></div>"
        var re = new RegExp("#AN=.*");



        if (re.test(sessionUrl)) {
          //The URL is valid; convert it to a permalink
          var articleId = new String(sessionUrl.match(re)).replace("#", "https://ezproxy.ccac.edu/login?url=https://search.ebscohost.com/login.aspx?direct=true&site=eds-live&");

          $('#result').html("<a href='" + articleId + "' target='_blank'>" + articleId + "</a>");
          $('#well').prepend(successMsg);
          $('#well').fadeIn();

        } else {
          //The URL is invalid; show the error message
          $('#result').html(errorMsg);
          $('#well').fadeIn();
        }

      });

      $('#btnReset').click(function() {
        setupForm();
      });
    });
  </script>
  <!--


-->


</body>

</html>